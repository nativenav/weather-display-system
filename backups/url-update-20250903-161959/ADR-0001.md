# ADR-0001: Use Cloudflare Workers + KV for the backend

Date: 2025-08-30

## Context
The ESP32C3 with a 7.5" ePaper needs to display weather data from multiple sources. On-device parsing (JSON/HTML/hex) is memory-intensive and slows iteration. We require:
- $0 operating cost
- Low-latency, reliable API for embedded clients
- Simple deployment and CI/CD
- Extensible schema suitable for mobile apps later

## Decision
Adopt Cloudflare Workers + KV as the primary backend platform.

### Rationale
- Generous free tier (100K req/day) and global edge
- KV for simple caching and storage
- TypeScript runtime with robust tooling
- Cron triggers for periodic collection
- Easy custom domains and TLS

### Alternatives Considered
- Google Colab: Not suitable for persistent web APIs, session timeouts
- Google Cloud Functions: Cold starts, more complexity for KV/caching
- Render.com: Viable backup, but sleeping services on free tier
- Vercel/Netlify: Function limits less aligned to periodic collectors

## Consequences
- Parser logic moves to TypeScript
- ESP32C3 client becomes a simple HTTP consumer
- Future mobile app consumes the same API

## Non-Functional Requirements
- Memory on device: < 30KB SRAM at runtime
- Payload size: ≤ 2KB for display format
- Update interval: 2–5 minutes typical
- Uptime: ≥ 99.5%

## Next Steps
- Phase 2: Initialize Workers project and first parser
- Phase 3: Implement minimal firmware client using Arduino CLI

## Toolchain Decision
Continue using **Arduino CLI/IDE** instead of PlatformIO:
- ✅ Existing projects already work perfectly
- ✅ Simpler toolchain, less configuration overhead
- ✅ Better library ecosystem via Arduino Library Manager
- ✅ Excellent GitHub Actions support (`arduino/setup-arduino-cli@v2`)
- ✅ Memory-efficient binaries for simple projects
- ✅ Native ESP32 OTA support in Arduino core

